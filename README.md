# rucio-dirac-dev

Basic test setup of rucio and dirac using docker compose.

This is material prepared from the on-going work at CTAO to
use DIRAC with Rucio for the Rucio-DIRAC 2025-01 workshop at CERN.


The setup here consists of a simplified Rucio and DIRAC setup,
running in docker compose on a single machine.

At the moment, it is not a development setup, as it relies
on the published release artifacts of both Rucio and DIRAC.

It could be expanded during the workshop to allow local
development (i.e. running the components based on local sources).

## Setup

This setup relies on the:

* docker compose
* Upstream Rucio docker images
* Upstream DIRACOS
* Upstream DIRAC PyPI packages
* A self-signed certificate chain, committed into the repository 
  for convenience but fully automatically generated by `./certs/generate_certificates.sh`

Since the setup requires executing commands in the started docker containers
in particular orders that cannot really be performed by entry points,
a python script performing these steps is provided.

Run `python3 dev_setup.py setup` to spin up all components.

For a clean start (removing everything including data), run
```
[host] $ python3 dev_setup.py teardown
```

## Tests

A couple of pytest-based tests are defined in `tests/`, which must be executed in the `clients`
container.

```
[host   ] $ docker compose exec clients bash
[clients] $ python3 -m pytest tests -v
```

The tests include adding/downloading data to/from rucio, 
submitting a simple job on DIRAC and then the interactions
that require the correct setup of the `RucioFileCatalog` in DIRAC:
Accessing data stored in Rucio via DIRAC and submitting jobs
that load/store input/output there.
